---
title: Histórico de doações
---

<section id="historico-doacoes" ng-controller="DonationHistoryController">
	<div class="container">
		<div class="row">
			<div class="col-md-12 text-center">
				<h1 class="page-title">Histórico de transações</h1>
			</div>

			<div class="col-md-6">
				<div class="dropdown">
					<button class="btn btn-default btn-sm dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown">
						Baixar...
						<span class="caret"></span>
					</button>
					<ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
						<li><a href="{{download.csv_file()}}" target="_blank">...doações autorizadas</a></li>
					</ul>
				</div>
			</div>

			<div class="col-md-12" style="margin-top:20px;">

				<div class="table-responsive">
					<div id="donations-table" aria-busy="{{ donationsLoading ? 'true' : 'false' }}">
						<div class="form-group" ng-show="donationsStatuses.length > 0">
							<label for="donations-status">Filtragem das doações</label>
							<select id="donations-status" ng-model="query" class="form-control ng-pristine ng-untouched ng-valid ng-not-empty" ng-change="updateFilteredList()">
								<option value="">todas as doações</option>
								<option ng-repeat="s in donationsStatuses" value="{{ s.name }}">{{ s.label }}</option>
							</select>
						</div>

						<table class="table table-striped table-bordered" ng-if="filteredDonations.length">
							<thead>
								<tr>
									<th>ID</th>
									<th>Decred</th>
									<th>Nome</th>
									<th>
										<abbr title="Cadastro de Pessoa Física">CPF</abbr>
									</th>
									<th>Telefone</th>
									<th>Endereço</th>
									<th>Nascimento</th>
									<th>Método</th>
									<th>Valor</th>
									<th>Data da doação</th>
									<th>Data da captura</th>
									<th>Data do extorno</th>
									<th>Status</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-if="donationsRecent.length > 0">
									<td colspan="13" class="alert alert-warning" role="alert">
										Há {{ donationsRecent.length }} novas doações desde {{ filteredDonations[filteredDonations.length - 1].created_at_human | date:'dd/MM/yyyy hh:mm:ss' }}.
									</td>
								</tr>
								<tr ng-if="donationsError">
									<td colspan="13" class="alert alert-danger" role="alert">
										Houve um erro no carregamento da lista de doações. Por favor, contate o suporte.
									</td>
								</tr>
								<tr class="text-center {{ item.status ? 'donation--' + item.status : '' }}" ng-repeat="item in filteredDonations track by $index">
									<td title="ID" class="donations-history__id">
										<span title="{{ item.id }}">{{ item.id }}</span>
									</td>
									<td title="Decred" class="donations-history__dcred-link">
										<a ng-if="item.transaction_link" href="{{ item.transaction_link }}" target="_blank" title="Registro na blockchain">
											<i class="fa fa-link"></i>
										</a>
									</td>
									<td title="Nome">
										{{ item.name }}
										<a href="mailto:{{ item.email }}" title="Enviar email para o doador" ng-if="item.email">
											<i class="fa fa-envelope-o"></i>
										</a>
									</td>
									<td title="CPF">
										{{ item.cpf | brCpf }}
									</td>
									<td title="Telefone">{{ item.phone ? ( item.phone | brPhoneNumber) : '-' }}</td>
									<td title="Endereço">
										{{ item.address_street || '-' }}{{ item.address_house_number ? ' ,' + item.address_house_number : '' }}
										{{ item.address_complement ? ' - ' + item.address_complement : '' }}
										{{ item.address_district ? ' - ' + item.address_district : '' }}
										{{ item.address_city ? ' - ' + item.address_city : '' }}
										{{ item.address_state ? ' - ' + item.address_state : '' }}{{ item.address_zipcode ? ', ' + (item.address_zipcode | brCep) : '' }}
									</td>
									<td title="Nascimento">{{ item.birthday || '-' }}</td>
									<td title="Método">{{ item.payment_method_human }}</td>
									<td title="Valor" class="text-nowrap">
										{{ item.amount ? (item.amount | finance: 'R$' ) : '-' }}
									</td>
									<td title="Data da doação">
										{{ item.created_at_human || '-' }}
									</td>
									<td title="Data da captura" class="{{ item.captured_at ? 'alert-success' : '' }}">
										{{ item.captured_at ? ( item.captured_at | date:'dd/MM/yyyy hh:mm:ss') : '-' }}
									</td>
									<td title="Data do extorno" class="{{ item.refunded_at ? 'alert-danger' : '' }}">
										{{ item.refunded_at ? ( item.refunded_at | date:'dd/MM/yyyy hh:mm:ss') : '-' }}
									</td>
									<%# <td title="Número do Documento">{{ item.document_number }}</td> %>
									<%# <td title="Número da Autorização">{{ item.authorization_number }}</td> %>
									<td title="Status">
										{{ item.payment_lr }}
										{{ (!!item.payment_lr === !!item.payment_message) ? '-' : '' }}
										{{ item.payment_message }}
									</td>
								</tr>
								<tr id="loading-donations" class="text-center {{ donationsLoading ? '' : 'hide' }}">
									<td colspan="13">
										<i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw text-success" style="opacity:0.6"></i>
										<p class="text-success">Carregando</p>
									</td>
								</tr>
							</tbody>
						</table>
						<button class="btn btn-default btn-sm center-block" type="button" ng-if="hasMoreDonations" ng-click="getDonationsList()">
							carregar mais
						</button>
					</div>
				<div class="carrega-mais-hist-container hide">
					<button id="carrega-mais-hist" class="btn btn-default">Carregar mais</button>
				</div>
			</div>

		</div>
	</div>

</section>

