/**
 * Candidate Controller
 */

var BASE_API_JS = '';




app.votolegal.controller('PreviewController', ["$scope", "$rootScope", "$http", "$sce", "serialize", "auth_service", "edit_cadidate", "get_candidate_by_name", "SweetAlert", "trouble", "postmon", function ($scope, $rootScope, $http, $sce, serialize, auth_service, edit_cadidate, get_candidate_by_name, SweetAlert, trouble, postmon) {

var server = window.location;
if (server.hostname == 'dev-participe.votolegal.com.br' || server.hostname == 'localhost') {
	BASE_API_JS = '//dapi.votolegal.com.br/api';
} else {
	BASE_API_JS = '//dapi.votolegal.com.br/api';
}



	var load = document.querySelector('#loading');
	$scope.candidate = {};
	$scope.themeActive = '';

	var user = auth_service.current_user();

	console.log(user, 'user')

	var locationHost = window.location.host;

	$scope.editConfigSite = function(valid, formData){

		edit_cadidate.edit(formData.themeActive, user, _)
		.success(function (res) {
			console.log(res, 'res')
		}).error(function (er) {
			console.log(er)
		})


		get_candidate_by_name.get_candidate(user)
		.succcess(function(success){

			console.log(success)

		}).error(function(error){
			console.log(error)

		})

	}







	// $scope.theme = '';

	//   $scope.choiceTheme = function(){
	// 	  alert()

	// // console.log(window.location, 'locatino')



	// //  	window.postMessage("hello there!", window.location.href );


	//   }

	// defaults




	/**
	 * getting data
	 */
	$scope.get_candidate = function () {
		var params = {};

		var user = auth_service.current_user();
		params['api_key'] = user.api_key;

		$http.get(BASE_API_JS + '/candidate/' + user.id + '?api_key=' + user.api_key)
			.then(
				function (response) {
					$scope.candidate = response.data.candidate;

					(function () {
						var boleto = document.querySelector('#show-boleto');
						if (boleto && $scope.candidate.status === 'activated') boleto.classList.remove('hide');
					})();

					$scope.candidate.profile_url = function () {
						return $sce.trustAsResourceUrl("//" + locationHost + "/candidato?id=" + $scope.candidate.username);
					};
				},
				function (response) {
					throw new Error('ERROR_GET_CANDIDATE')
				}
			);
		return false;
	};

	/**
	 * initializations
	 */
	auth_service.validate_user({
		role: 'user'
	});
	$scope.get_candidate();
}]);
