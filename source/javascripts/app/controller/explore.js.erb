/**
 * Explore Controller
 */
app.votolegal.controller('ExploreController', ["$scope", "$http", "auth_service", "serialize", "SweetAlert", "trouble", function($scope, $http, auth_service, serialize, SweetAlert, trouble){
  // defaults
  $scope.list = [];
  $scope.typesearch = 'name';

  // methods
  $scope.redirect_to = function(candidate){
    if(candidate.website_url.length > 0){
      var w = window.open(candidate.website_url, '_blank');
      w.focus();
      return false;
    }

    SweetAlert.swal('Website não definido', 'Este candidato não configurou nenhum website para acesso.');
    //document.location = '//'+ username +'.votolegal.org.br/candidato';
    return false;
  };

  $scope.set_typesearch = function(type){
    $scope.typesearch = type;
  };

  $scope.load_list = function(term){
    var params = { name: term };
    switch($scope.typesearch){
      case 'name':
        params = { name: term };
        break;
      case 'city':
        params = { address_city: term };
        break;
    }

    $http({
      method: 'post',
      url: '<%= config[:api_host] %>/search?results=9999', 
      data: serialize.from_object(params),
      headers: {'Content-Type': 'application/x-www-form-urlencoded'}
    })
    .then(
      function(response){
        $scope.list = response.data;
      },
      function(response){
        var data = response.data;
        SweetAlert.swal('Erro inesperado', 'Não foi possivel carregar a lista de usuários!');
        trouble({
          route: document.location.href, error: JSON.stringify(response)
        });
      }
    );
    return false;
  };

  // load candidate list
  var term = URI.query('q') || undefined;
  $scope.typesearch = URI.query('type') || 'name';
  $scope.load_list(term);
}]);
