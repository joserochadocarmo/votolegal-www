/**
 * Explore Controller
 */
app.votolegal.controller('ExploreController', ["$scope", "$http", "auth_service", "serialize", "SweetAlert", "trouble", function($scope, $http, auth_service, serialize, SweetAlert, trouble){
  // defaults
  $scope.list = [];

  // methods
  $scope.redirect_to = function(candidate){
    if(candidate.website_url.length > 0){
      var w = window.open(candidate.website_url, '_blank');
      w.focus();
      return false;
    }

    SweetAlert.swal('Website não definido', 'Este candidato não configurou nenhum website para acesso.');
    //document.location = '//'+ username +'.votolegal.org.br/candidato';
    return false;
  };

  $scope.load_list = function(term){
    $http({
      method: 'post',
      url: '<%= config[:api_host] %>/search', 
      data: serialize.from_object({ name: term }),
      headers: {'Content-Type': 'application/x-www-form-urlencoded'}
    })
    .then(
      function(response){
        $scope.list = response.data;
        console.log($scope.list); // DEBUG
      },
      function(response){
        var data = response.data;
        console.log(response); // DEBUG
        SweetAlert.swal('Erro inesperado', 'Não foi possivel carregar a lista de usuários!');
        trouble({
          route: '/explore', error: JSON.stringify(response)
        });
      }
    );
    return false;
  };

  // load candidate list
  var term = URI.query('q') || undefined;
  console.log(term);
  $scope.load_list(term);
}]);
