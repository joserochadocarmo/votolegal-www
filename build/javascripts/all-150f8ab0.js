!function(e){Array.prototype.map||(Array.prototype.map=function(e,r){var t,o,a;if(null==this)throw new TypeError(" this is null or not defined");var n=Object(this),i=n.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(t=r),o=new Array(i),a=0;i>a;){var s,c;a in n&&(s=n[a],c=e.call(t,s,a,n),o[a]=c),a++}return o}),Array.prototype.filter||(Array.prototype.filter=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var r=Object(this),t=r.length>>>0;if("function"!=typeof e)throw new TypeError;for(var o=[],a=arguments.length>=2?arguments[1]:void 0,n=0;t>n;n++)if(n in r){var i=r[n];e.call(a,i,n,r)&&o.push(i)}return o});var r={absolute:function(){return document.location.href},query:function(e){var r=this.absolute();e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),o=t.exec(r);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}},t=function(){this.from_object=function(e){var r=[];if("object"!=typeof e)throw new Error("Param to be serializer isnt a object");for(var t in e)if(e.hasOwnProperty(t)){var o=e[t];r.push(encodeURIComponent(t)+"="+encodeURIComponent(null==o?"":o))}return r.join("&").replace(/%20/g,"+")},this.from_form=function(e){var r=document.forms[e],t={};for(var o in r.elements)void 0!==r.elements[o].type&&(t[r.elements[o].name]=r.elements[o].value);return this.from_object(t)},this.to_json=function(e){return JSON.stringify(e)}},o=function(e){var r={missing:" n\xe3o foi preenchido.",invalid:" est\xe1 inv\xe1lido.","already exists":" j\xe1 foi cadastrado.","access denied":"Acesso negado!","Bad email or password.":"E-mail ou senha inv\xe1lidos.","invalid token":" \xe9 invalido ou esta expirado."};return r[e]};e.votolegal=angular.module("votolegal",["ngRoute","ngMask","ngSanitize","angular-storage","idf.br-filters"]),e.votolegal.config(["$httpProvider","$locationProvider",function(e,r){delete e.defaults.headers.common["X-Requested-With"],e.defaults.headers.common["Content-Type"]="application/x-www-form-urlencoded",r.html5Mode(!1)}]),e.votolegal.filter("unsafe",["$sce",function(e){return function(r){return e.trustAsHtml(r)}}]),e.votolegal.factory("postmon",["$http",function(e){return function(r){return e.get("//api.postmon.com.br/v1/cep/"+r,{cache:!1})}}]),e.votolegal.factory("serialize",function(){return new t}),e.votolegal.factory("auth_service",["$http","serialize","store",function(e,r,t){return{session_key:"user",sign_page:"/admin/signin",admin_page:"/admin",role_list:{admin:"/admin",user:"/pre-cadastro/aprovado"},authenticate:function(t,o){return e({method:"POST",url:"/api/login",data:r.from_object({email:t,password:o}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},forgot_password:function(t){return e({method:"POST",url:"/api/login/forgot_password",data:r.from_object({email:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},change_password:function(t,o){return e({method:"POST",url:"/api/login/forgot_password/reset/"+o,data:r.from_object({new_password:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},session:function(){return t},current_user:function(){return this.session().get(this.session_key)},validate_user:function(){var e=arguments[0]||{},r=this.current_user();return-1==document.location.href.indexOf(this.sign_page)&&(void 0==r&&(document.location=this.sign_page),r.role!=e.role&&(document.location="/error/permissao-negada")),!1},logout:function(){return this.session().remove(this.session_key),arguments[0]&&(document.location=arguments[0]),!1}}}]),e.votolegal.controller("PreCadastroController",["$scope","$http","postmon","serialize",function(e,r,t,a){e.candidate={},e.submit_disabled=!1,e.register_params=function(){return e.candidate},e.create=function(){var t=e.register_params();return e.error_list=[],e.candidate.password&&e.candidate.password==e.candidate.confirm_password?e.accept_terms||e.transparent_campaign?(e.submit_disabled=!0,r({method:"POST",url:"/api/register",data:a.from_object(t),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){return 0==e.error_list.length&&(document.location="/pre-cadastro/success"),!1},function(r){var t=r.data.form_error,a=function(e){return document.querySelector("form[name=candidateForm] *[name="+e+"]")};for(var n in t){var i=a(n).attributes.placeholder.value;e.error_list.push(i+o(t[n]))}throw e.candidate.password&&e.candidate.password!=e.candidate.confirm_password&&e.error_list.push("Os campos de senha devem ser iguais."),e.accept_terms||e.transparent_campaign||(e.accept_terms||e.error_list.push("Voc\xea deve aceitar os termos de uso."),e.transparent_campaign||e.error_list.push("Voc\xea deve aceitar fazer uma campanha transparente.")),e.submit_disabled=!1,new Error("ERROR_POST_NEW_CADIDATE")}),!1):(e.accept_terms||e.error_list.push("Voc\xea deve aceitar os termos de uso."),e.transparent_campaign||e.error_list.push("Voc\xea deve aceitar fazer uma campanha transparente."),!1):(e.error_list.push("Os campos de senha devem ser iguais."),!1)},e.address_by_zipcode=function(){var r=e.candidate.address_zipcode;return 9==r.length&&t(r).then(function(r){var t=r.data,o=e.candidate;o.address_city=t.cidade,o.address_state=t.estado_info.nome;var a=document.querySelector("form[name=candidateForm] *[name=address_street]");t.bairro&&t.logradouro?(o.address_street=t.logradouro+" - "+t.bairro,a.disabled=!0):(o.address_street="",a.disabled=!1)},function(){throw swal({title:"Problemas ao carregar os dados do CEP!",text:"Ocorreu um erro ao tentar carregar os dados de sua localidade. Verifique o CEP e tente novamente."}),new Error("ERROR_GET_ZIPCODE")}),!1},e.load_parties=function(){r.get("/api/party").then(function(r){e.party_list=r.data.party},function(){throw e.party_list=[],new Error("ERROR_GET_PARTY_LIST")})},e.load_offices=function(){r.get("/api/office").then(function(r){e.office_list=r.data.office},function(){throw e.office_list=[],new Error("ERROR_GET_OFFICE_LIST")})},e.reset=function(){e.candidate={}},e.load_offices(),e.load_parties()}]),e.votolegal.controller("ContatoController",["$scope","$http","serialize",function(e,r,t){e.message={},e.message_params=function(){return e.message},e.create=function(){var a=e.message_params();return r({method:"POST",url:"/api/contact",data:t.from_object(a),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){e.data;return document.location="/contato/success",!1},function(r){var t=r.data.form_error,a=function(e){return document.querySelector("form[name=contactForm] *[name="+e+"]")};e.error_list=[];for(var n in t){var i=a(n).attributes.placeholder.value;e.error_list.push(i+o(t[n]))}throw new Error("ERROR_POST_NEW_CONTACT")}),!1}}]),e.votolegal.controller("FaqController",["$scope","$sce",function(e){e.highlight=!0,e.faq_list=faq_list,e.search_answer=function(r){var t=faq_list.map(function(e){return e.title.match(new RegExp(r,"ig"))||e.content.match(new RegExp(r,"gi"))?e:void 0}),o=function(e){var r=[];for(var t in e)void 0!==e[t]&&r.push(e[t]);return r};return e.faq_list=o(t),!1}}]),e.votolegal.controller("AuthController",["$scope","$http","auth_service",function(e,t,a){e.signin={},e.error_list=[],e.signin.token=r.query("token"),e.signin_params=function(){return e.signin},e.forgot_password=function(){e.error_list=[];var r=e.signin_params();return a.forgot_password(r.email).then(function(e){e.data;document.location="/conta/recuperar-senha/success"},function(r){var t=r.data;if(t.hasOwnProperty("form_error")){var t=t.form_error,a=function(e){return document.querySelector("form[name=forgotForm] *[name="+e+"]")};for(var n in t){var i=a(n).attributes.placeholder.value;e.error_list.push(i+o(t[n]))}}else e.error_list.push(o(t.error));throw new Error("ERROR_FORGOT_PASSWORD")}),!1},e.change_password=function(){e.error_list=[];var r=e.signin_params();return null==r.password&&e.error_list.push("Nova Senha \xe9 um campo obrigat\xf3rio."),r.password!==r.confirm_password&&e.error_list.push("Os campos de senha devem ser iguais."),e.error_list.length>0?!1:(a.change_password(r.password,r.token).then(function(e){e.data;document.location="/conta/trocar-senha/success"},function(r){var t=r.data;if(t.hasOwnProperty("form_error")){var t=t.form_error,a=function(e){return document.querySelector("form[name=changePasswordForm] *[name="+e+"]")};for(var n in t){var i=a(n).attributes.placeholder.value;e.error_list.push(i+o(t[n]))}}else e.error_list.push(o(t.error));throw new Error("ERROR_CHANGE_PASSWORD")}),!1)},e.authenticate=function(){var r=e.signin_params();return a.authenticate(r.email,r.password).then(function(e){var r=e.data,t=r.roles||[],o=a.session();if(o.set(a.session_key,{id:r.candidate_id,api_key:r.api_key,role:t[0]||null}),0==t.length)return document.location="/admin/signin",!1;for(var n in t)"admin"===t[n]&&(document.location="/admin"),"user"===t[n]&&(document.location="/pre-cadastro/aprovado")},function(r){e.error_list=[];var t=r.data;if(t.form_error){var t=t.form_error,a=function(e){return document.querySelector("form[name=signinForm] *[name="+e+"]")};for(var n in t){var i=a(n).attributes.placeholder.value;e.error_list.push(i+o(t[n]))}}else e.error_list.push(o(t.error));throw new Error("ERROR_AUTH_USER")}),!1}}]),e.votolegal.controller("DashboardController",["$scope","$http","auth_service","serialize",function(e,r,t){e.list=[],e.approval_list=function(){var o=t.current_user();return r.get("/api/admin/candidate/list?api_key="+o.api_key).then(function(r){var t=r.data;e.list=t},function(e){var r=e.data;"access denied"===r.error&&(document.location=t.sign_page)}),!1},e.allow=function(a){var n=t.current_user();return swal({title:"Tem certeza?",text:"Voc\xea tem certeza que deseja autorizar este pr\xe9-candidato?",showCancelButton:!0,confirmButtonText:"Sim",cancelButtonText:"N\xe3o",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&r({method:"PUT",url:"/api/admin/candidate/"+a.id+"/activate?api_key="+n.api_key}).then(function(){swal({title:"Aprovado!",text:"O pr\xe9-candidato foi aprovado para utilizar o sistema!"}),e.approval_list()},function(e){var r=e.data;swal(o(r.error))})}),!1},e.deny=function(a){var n=t.current_user();return swal({title:"Tem certeza?",text:"Voc\xea tem certeza que deseja rejeitar este pr\xe9-candidato?",showCancelButton:!0,confirmButtonText:"Sim",cancelButtonText:"N\xe3o",closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&r({method:"PUT",url:"/api/admin/candidate/"+a.id+"/deactivate?api_key="+n.api_key}).then(function(){swal({title:"Rejeitado!",text:"O pr\xe9-candidato foi rejeitado com sucesso!"}),e.approval_list()},function(e){var r=e.data;swal(o(r.error))})}),!1},e.approval_list(),t.validate_user({role:"admin"})}]),e.votolegal.controller("PreCandidateController",["$scope","$http","serialize","auth_service",function(e,t,o,a,n){var i=n.current_user();e.model={},e.params=r.query(),e.load=function(r){try{r=parseInt(r)}catch(o){throw new Error("Parametro id \xe9 inv\xe1lido")}return t({method:"GET",url:"/api/candidate/"+r+"?api_key="+i.api_key}).then(function(r){var t=r.data.candidate;e.model=t},function(){throw new Error("Model is invalid or cannot be found!")}),!1},e.load(e.params.id),n.validate_user({role:"admin"})}]),e.votolegal.controller("DefaultController",["$scope","$http","auth_service","serialize",function(e,r,t){t.validate_user({role:"user"})}]),document.location.href.indexOf("/cadastro-completo")>=0&&e.votolegal.config(["$routeProvider",function(e){e.when("/dados-pessoais",{templateUrl:"/javascripts/app/view/cadastro/dados-pessoais.tmpl",controller:"CadastroController"}).when("/dados-campanha",{templateUrl:"/javascripts/app/view/cadastro/dados-campanha.tmpl",controller:"CadastroController"}).when("/projetos",{templateUrl:"/javascripts/app/view/cadastro/projetos.tmpl",controller:"CadastroController"}).otherwise({redirectTo:"/dados-pessoais"})}]),e.votolegal.controller("CadastroController",["$scope","$http","$location","auth_service","serialize",function(e,r,t,o,a){e.issues={},e.candidate={},e.projects=[1,2,3,4].map(function(){return{title:"",description:""}}),e.tabname="",e.submit_disabled=!1,e.progress={percent:0},e.issue_list=[],e.register_params=function(){return e.candidate},e.update=function(){var t=e.register_params();e.error_list=[];var n=o.current_user();return t.api_key=n.api_key,e.submit_disabled=!0,r.put("/api/candidate/"+n.id,a.from_object(t),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),!1},e._get_candidate=function(){var t=e.register_params(),n=o.current_user();return t.api_key=n.api_key,r.get("/api/candidate/"+n.id,a.from_object(t)).then(function(r){var t=r.data.candidate;e.candidate=t},function(e){console.log(e)}),!1},e.count_checked=function(r){var t=e.issue_list.filter(function(e){return e.selected?!0:void 0});t.length>4&&(r.i.selected=!1,swal("Selecione apena 4 assuntos"))},e.add_project=function(){return e.projects.push({title:"",description:""}),!1},e.get_issues_priority=function(){r.get("/api/issue_priority").then(function(r){var t=r.data.issue_priority;e.issue_list=t},function(){throw new Error("ERROR_GET_ISSUE_PRIORITY")})},e._get_tabname=function(){var e=t.path();return"/dados-pessoais"==e?"pessoal":"/dados-campanha"==e?"campanha":"/projetos"==e?"projetos":void 0},o.validate_user({role:"user"}),e.tabname=e._get_tabname(),e._get_candidate(),e.get_issues_priority()}])}(window.app=window.app||{});