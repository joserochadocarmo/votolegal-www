!function(e){Array.prototype.map||(Array.prototype.map=function(e,r){var t,a,n;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),i=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(t=r),a=new Array(i),n=0;i>n;){var s,c;n in o&&(s=o[n],c=e.call(t,s,n,o),a[n]=c),n++}return a});var r=function(){this.from_object=function(e){var r=[];if("object"!=typeof e)throw new Error("Param to be serializer isnt a object");for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];r.push(encodeURIComponent(t)+"="+encodeURIComponent(null==a?"":a))}return r.join("&").replace(/%20/g,"+")},this.from_form=function(e){var r=document.forms[e],t={};for(var a in r.elements)void 0!==r.elements[a].type&&(t[r.elements[a].name]=r.elements[a].value);return this.from_object(t)},this.to_json=function(e){return JSON.stringify(e)}};e.votolegal=angular.module("votolegal",["ngMask","ngSanitize","angular-storage","idf.br-filters"]),e.votolegal.config(["$httpProvider","$locationProvider",function(e,r){delete e.defaults.headers.common["X-Requested-With"],e.defaults.headers.common["Content-Type"]="application/x-www-form-urlencoded",r.html5Mode(!0)}]),e.votolegal.filter("unsafe",["$sce",function(e){return function(r){return e.trustAsHtml(r)}}]),e.votolegal.factory("postmon",["$http",function(e){return function(r){return e.get("//api.postmon.com.br/v1/cep/"+r,{cache:!1})}}]),e.votolegal.factory("serialize",function(){return new r}),e.votolegal.factory("auth_service",["$http","serialize","store",function(e,r,t){return{session_key:"user",sign_page:"/admin/signin",admin_page:"/admin",authenticate:function(t,a){return e({method:"POST",url:"/api/login",data:r.from_object({email:t,password:a}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},session:function(){return t},current_user:function(){return this.session().get(this.session_key)},validate_user:function(){var e=this.current_user();return-1==document.location.href.indexOf(this.sign_page)?void 0==e&&(document.location=this.sign_page):void 0!=e&&(document.location=this.admin_page),!1}}}]),e.votolegal.controller("PreCadastroController",["$scope","$http","postmon","serialize",function(e,r,t,a){e.candidate={},e.submit_disabled=!1,e.register_params=function(){return e.candidate},e.create=function(){var t=e.register_params();return e.error_list=[],e.candidate.password&&e.candidate.password==e.candidate.confirm_password?e.accept_terms||e.transparent_campaign?(e.submit_disabled=!0,r({method:"POST",url:"/api/register",data:a.from_object(t),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){return 0==e.error_list.length&&(document.location="/pre-cadastro/success"),!1},function(r){var t=r.data.form_error,a=function(e){return document.querySelector("form[name=candidateForm] *[name="+e+"]")},n=function(e){var r={missing:" n\xe3o foi preenchido.","already exists":" j\xe1 foi cadastrado.",invalid:" est\xe1 inv\xe1lido."};return r[e]};for(var o in t){var i=a(o).attributes.placeholder.value;e.error_list.push(i+n(t[o]))}throw e.candidate.password&&e.candidate.password!=e.candidate.confirm_password&&e.error_list.push("Os campos de senha devem ser iguais."),e.accept_terms||e.transparent_campaign||(e.accept_terms||e.error_list.push("Voc\xea deve aceitar os termos de uso."),e.transparent_campaign||e.error_list.push("Voc\xea deve aceitar fazer uma campanha transparente.")),e.submit_disabled=!1,new Error("ERROR_POST_NEW_CADIDATE")}),!1):(e.accept_terms||e.error_list.push("Voc\xea deve aceitar os termos de uso."),e.transparent_campaign||e.error_list.push("Voc\xea deve aceitar fazer uma campanha transparente."),!1):(e.error_list.push("Os campos de senha devem ser iguais."),!1)},e.address_by_zipcode=function(){var r=e.candidate.address_zipcode;return 9==r.length&&t(r).then(function(r){var t=r.data,a=e.candidate;a.address_city=t.cidade,a.address_state=t.estado_info.nome;var n=document.querySelector("form[name=candidateForm] *[name=address_street]");t.bairro&&t.logradouro?(a.address_street=t.logradouro+" - "+t.bairro,n.disabled=!0):(a.address_street="",n.disabled=!1)},function(){throw swal({title:"Problemas ao carregar os dados do CEP!",text:"Ocorreu um erro ao tentar carregar os dados de sua localidade. Por gentileza preencha os campos manualmente."}),new Error("ERROR_GET_ZIPCODE")}),!1},e.load_parties=function(){r.get("/api/party").then(function(r){e.party_list=r.data.party},function(){throw e.party_list=[],new Error("ERROR_GET_PARTY_LIST")})},e.load_offices=function(){r.get("/api/office").then(function(r){e.office_list=r.data.office},function(){throw e.office_list=[],new Error("ERROR_GET_OFFICE_LIST")})},e.reset=function(){e.candidate={}},e.load_offices(),e.load_parties()}]),e.votolegal.controller("ContatoController",["$scope","$http","serialize",function(e,r,t){e.message={},e.message_params=function(){return e.message},e.create=function(){var a=e.message_params();return r({method:"POST",url:"/api/contact",data:t.from_object(a),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){e.data;return document.location="/contato/success",!1},function(r){var t=r.data.form_error,a=function(e){return document.querySelector("form[name=contactForm] *[name="+e+"]")},n=function(e){var r={missing:" n\xe3o foi preenchido.","already exists":" j\xe1 foi cadastrado.",invalid:" est\xe1 inv\xe1lido."};return r[e]};e.error_list=[];for(var o in t){var i=a(o).attributes.placeholder.value;e.error_list.push(i+n(t[o]))}throw new Error("ERROR_POST_NEW_CONTACT")}),!1}}]),e.votolegal.controller("FaqController",["$scope","$sce",function(e){e.highlight=!0,e.faq_list=faq_list,e.search_answer=function(r){var t=faq_list.map(function(e){return e.title.match(new RegExp(r,"ig"))||e.content.match(new RegExp(r,"gi"))?e:void 0}),a=function(e){var r=[];for(var t in e)void 0!==e[t]&&r.push(e[t]);return r};return e.faq_list=a(t),!1}}]),e.votolegal.controller("AuthController",["$scope","auth_service",function(e,r){e.signin={},e.error_list=[],e.signin_params=function(){return e.signin},e.authenticate=function(){var t=e.signin_params();return r.authenticate(t.email,t.password).then(function(e){var t=e.data,a=r.session();if(a.set(r.session_key,{id:t.user_id,api_key:t.api_key}),0==t.roles.length)return document.location="/admin/signin",!1;for(var n in t.roles)"admin"===t.roles[n]&&(document.location="/admin");return!1},function(r){e.error_list=[];var t=r.data;if(t.form_error){var t=t.form_error,a=function(e){return document.querySelector("form[name=signinForm] *[name="+e+"]")},n=function(e){var r={missing:" n\xe3o foi preenchido.",invalid:" est\xe1 inv\xe1lido."};return r[e]};for(var o in t){var i=a(o).attributes.placeholder.value;e.error_list.push(i+n(t[o]))}}else{var n=function(e){var r={missing:" n\xe3o foi preenchido.",invalid:" est\xe1 inv\xe1lido.","Bad email or password.":"E-mail ou senha inv\xe1lidos."};return r[e]};e.error_list.push(n(t.error))}throw console.log(r),new Error("ERROR_AUTH_USER")}),!1},r.validate_user()}]),e.votolegal.controller("DashboardController",["$scope","$http","auth_service","serialize",function(e,r,t){e.list=[],e.approval_list=function(){var a=t.current_user();r({method:"GET",url:"/api/admin/candidate/list?api_key="+a.api_key}).then(function(r){var t=r.data;return e.list=t,!1},function(e){var r=e.data;return"access denied"===r.error&&(document.location=t.sign_page),!1})},e.allow=function(a){var n=t.current_user();return r({method:"PUT",url:"/api/admin/candidate/"+a.id+"/activate?api_key="+n.api_key}).then(function(){return swal("Pr\xe9-candidato aprovado com sucesso"),e.approval_list(),!1},function(e){var r=e.data,t=function(e){var r={"access denied":"Acesso negado!"};return r[e]||""};return swal(t(r.error)),!1}),!1},e.deny=function(a){var n=t.current_user();return r({method:"PUT",url:"/api/admin/candidate/"+a.id+"/deactivate?api_key="+n.api_key}).then(function(){return swal("Pr\xe9-candidato rejeitado com sucesso"),e.approval_list(),!1},function(e){var r=e.data,t=function(e){var r={"access denied":"Acesso negado!"};return r[e]||""};return swal(t(r.error)),!1}),!1},e.approval_list(),t.validate_user()}]),e.votolegal.controller("PreCandidateController",["$scope","$http","$location","serialize","auth_service",function(e,r,t,a,n){var o=n.current_user();e.model={},e.params=t.search(),e.load=function(t){try{t=parseInt(t)}catch(a){throw new Error("Parametro id \xe9 inv\xe1lido")}return r({method:"GET",url:"/api/candidate/"+t+"?api_key="+o.api_key}).then(function(r){var t=r.data.candidate;e.model=t},function(){throw new Error("Model is invalid or cannot be found!")}),!1},e.load(e.params.id),n.validate_user()}])}(window.app=window.app||{});