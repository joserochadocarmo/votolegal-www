app.votolegal.controller("AuthController",["$scope","$http","auth_service",function(r,e,o){r.signin={},r.error_list=[],r.signin.token=URI.query("token"),r.signin_params=function(){return r.signin},r.forgot_password=function(){r.error_list=[];var e=r.signin_params();return o.forgot_password(e.email).then(function(r){r.data;document.location="/conta/recuperar-senha/success"},function(e){var o=e.data;if(o.hasOwnProperty("form_error")){var o=o.form_error,n=function(r){return document.querySelector("form[name=forgotForm] *[name="+r+"]")};for(var a in o){var t=n(a).attributes.placeholder.value;r.error_list.push(t+error_msg(o[a]))}}else r.error_list.push(error_msg(o.error));throw new Error("ERROR_FORGOT_PASSWORD")}),!1},r.change_password=function(){r.error_list=[];var e=r.signin_params();return null==e.password&&r.error_list.push("Nova Senha \xe9 um campo obrigat\xf3rio."),e.password!==e.confirm_password&&r.error_list.push("Os campos de senha devem ser iguais."),r.error_list.length>0?!1:(o.change_password(e.password,e.token).then(function(r){r.data;document.location="/conta/trocar-senha/success"},function(e){var o=e.data;if(o.hasOwnProperty("form_error")){var o=o.form_error,n=function(r){return document.querySelector("form[name=changePasswordForm] *[name="+r+"]")};for(var a in o){var t=n(a).attributes.placeholder.value;r.error_list.push(t+error_msg(o[a]))}}else r.error_list.push(error_msg(o.error));throw new Error("ERROR_CHANGE_PASSWORD")}),!1)},r.authenticate=function(){var e=r.signin_params();return o.authenticate(e.email,e.password).then(function(r){var e=r.data,n=e.roles||[];e.candidate_name=e.candidate_name||"";var a=e.candidate_name.split(/\s+/).shift(),t=o.session();if(t.set(o.session_key,{id:e.candidate_id,api_key:e.api_key,name:a,role:n[0]||null}),0==n.length)return document.location="/admin/signin",!1;for(var s in n)"admin"===n[s]&&(document.location="/admin"),"user"===n[s]&&(document.location="/pre-cadastro/aprovado")},function(e){r.error_list=[];var o=e.data;if(o.form_error){var o=o.form_error,n=function(r){return document.querySelector("form[name=signinForm] *[name="+r+"]")};for(var a in o){var t=n(a).attributes.placeholder.value;r.error_list.push(t+error_msg(o[a]))}}else r.error_list.push(error_msg(o.error));throw new Error("ERROR_AUTH_USER")}),!1}}]);