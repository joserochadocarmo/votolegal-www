app.votolegal.controller("BoletoController",["$scope","$http","postmon","auth_service","serialize","SweetAlert","trouble",function(e,r,t,o,a,d,n){e.candidate={},e.payment={},e.bank_list=[],e.accept_terms=0,e.submit_disabled=!1,e.address_by_zipcode=function(){var r=e.candidate.address_zipcode;return 8==r.length&&t(r).then(function(r){var t=r.data,o=e.candidate;o.address_city=t.cidade,o.address_state=t.estado_info.nome;var a=document.querySelector("form[name=boletoForm] *[name=address_district]");t.bairro?(o.address_district=t.bairro,a.disabled=!0):(o.address_district="",a.disabled=!1);var d=document.querySelector("form[name=boletoForm] *[name=address_street]");t.logradouro?(o.address_street=t.logradouro,d.disabled=!0):(o.address_street="",d.disabled=!1)},function(){throw swal({title:"Problemas ao carregar os dados do CEP!",text:"Ocorreu um erro ao tentar carregar os dados de sua localidade. Verifique o CEP e tente novamente."}),["address_state","address_city","address_district","address_street"].map(function(r){try{e.candidate[r]="",document.querySelector("form[name=boletoForm] *[name="+r+"]").disabled=!0}catch(t){}}),new Error("ERROR_GET_ZIPCODE")}),!1},e.get_session=function(){var t=o.current_user();return r({method:"GET",url:"/api/candidate/"+t.id+"/payment/session?api_key="+t.api_key}).then(function(r){e.payment.session=r.data.id||0;try{PagSeguroDirectPayment.setSessionId(r.data.id)}catch(t){}},function(e){throw n.shoot({route:"/cadastro/boleto",error:JSON.stringify(e)}),new Error("ERROR_GET_SESSION")}),!1},e.get_banks=function(){return r({method:"GET",url:"/api/bank"}).then(function(r){e.bank_list=r.data.bank},function(e){throw n.shoot({route:"/cadastro/boleto",error:JSON.stringify(e)}),new Error("ERROR_GET_BANK")}),!1},e.load_candidate=function(){var t=o.current_user();return r({method:"GET",url:"/api/candidate/"+t.id+"?api_key="+t.api_key}).then(function(r){var t=r.data.candidate;t.address_district||(document.querySelector("form[name=boletoForm] *[name=address_district]").disabled=!1),function(){var e=t.address_street.split(" - ");2==e.length&&(e[0]?t.address_street=e[0]:document.querySelector("form[name=boletoForm] *[name=address_street]").disabled=!1,console.log(document.querySelector("form[name=boletoForm] *[name=address_street]")),e[1]?t.address_district=e[1]:document.querySelector("form[name=boletoForm] *[name=address_district]").disabled=!1)}(),e.candidate=t},function(e){throw n.shoot({route:document.location.href,error:JSON.stringify(e)}),new Error("Model is invalid or cannot be found!")}),!1},e.generate=function(){var t=PagSeguroDirectPayment.getSenderHash(),s=o.current_user();if(!e.accept_terms||0==e.accept_terms)return d.swal("Error","Voc\xea deve aceitar o termo de contrato!"),!1;var i=Params.require(e.candidate).permit("phone","address_zipcode","address_city","address_state","address_street","address_house_number","address_district");return r({method:"PUT",url:"/api/candidate/"+s.id+"?api_key="+s.api_key,data:a.from_object(i),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){r({method:"POST",url:"/api/candidate/"+s.id+"/payment?api_key="+s.api_key,data:a.from_object({senderHash:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){var r=e.data.url;document.location=r},function(e){throw n.shoot({route:document.location.href,error:JSON.stringify([e,s])}),d.swal("Erro Inesperado","N\xe3o foi possivel emitir o boleto!"),new Error("ERROR_GET_BOLETO")})},function(r){var t=r.data.form_error;n.shoot({route:document.location.href,error:JSON.stringify([r,s])});var o=function(e){return document.querySelector("form[name=boletoForm] *[name="+e+"]")};for(var a in t){var d=o(a).attributes["data-name"].value;e.error_list.push(d+error_msg(t[a]))}throw e.submit_disabled=!1,new Error("ERROR_PUT_CADIDATE")}),!1},o.validate_user({role:"user"}),e.load_candidate(),e.get_banks(),e.get_session()}]);