document.location.href.indexOf("/candidato")>=0&&(app.votolegal.config(["$routeProvider",function(e){e.when("/",{templateUrl:"/javascripts/app/view/candidato/index.tmpl",controller:"CandidateController"}).when("/doar",{templateUrl:"/javascripts/app/view/candidato/doar.tmpl",controller:"CandidateController"}).otherwise({redirectTo:"/"})}]),$(document).ready(function(){$("body").on("click","input.opcao_doar_radio",function(e){e.preventDefault,$(this).hasClass("opcao_doar_diff")?$(this).closest(".valor-doa-container").find(".doar-number-diferente").attr("disabled",!1):$(".doar-number-diferente").attr("disabled",!0),$(".valor-doa-container").removeClass("doa-container-active"),$(this).closest(".valor-doa-container").addClass("doa-container-active")}),$("input.opcao_doar_radio:checked").trigger("click")})),app.votolegal.controller("CandidateController",["$scope","$http","$sce","serialize","auth_service","SweetAlert","trouble","postmon",function(e,r,a,o,t,n,d,i){e.candidate={},e.doar={},e.payment={},e.name=function(){var e=document.location.href;return e=e.split(/\//)[2].split(".")[0],"localhost"!==e?e:void 0}(),e.month_list=function(){list=[];for(var e=1;12>=e;e++)list.push(e);return list}(),e.year_list=function(){list=[];for(var e=2016;2030>=e;e++)list.push(e);return list}(),e.make_percent=function(e,r){return 0===r?"0%":(e/r*100).toFixed(2)+"%"},e.render_video=function(e){return'<iframe id="candidate_video" src="'+a.trustAsResourceUrl(e)+'" width="560" height="315" allowfullscreen></iframe>'},e._issues_priorities_decorator=function(r){return e.candidate.candidate_issue_priorities.map(function(e){return e.name}).join(r||", ")},e.candidate_by_name=function(a){return r({method:"GET",url:"/api/candidate/"+a}).then(function(r){var a=r.data.candidate;e.candidate=a,function(){var r=document.querySelector("title");"VotoLegal - Candidato(a)"===r.innerText&&(r.innerText+=" "+e.candidate.popular_name)}(),e.candidate.issues_decorator=e._issues_priorities_decorator(),e.candidate.total_donated=e.candidate.total_donated||0,e.candidate.raising_goal=parseFloat(e.candidate.raising_goal)||0,function(){var r=document.querySelector("#video-renderer");r&&(r.innerHTML=e.render_video(a.video_url))}(),e.candidate.projects=[],e.candidate_projects(a)},function(e){throw d.shoot({route:document.location.href,error:JSON.stringify(e)}),new Error("Model is invalid or cannot be found!")}),!1},e.address_by_zipcode=function(){var r=e.doar.address_zipcode;return 9==r.length&&i(r).then(function(r){var a=r.data,o=e.doar;o.address_city=a.cidade,o.address_state=a.estado_info.nome;var t=document.querySelector("form[name=doarForm] *[name=address_district]");a.bairro?(o.address_district=a.bairro,t.disabled=!0):(o.address_district="",t.disabled=!1);var n=document.querySelector("form[name=doarForm] *[name=address_street]");a.logradouro?(o.address_street=a.logradouro,n.disabled=!0):(o.address_street="",n.disabled=!1)},function(){throw swal({title:"Problemas ao carregar os dados do CEP!",text:"Ocorreu um erro ao tentar carregar os dados de sua localidade. Verifique o CEP e tente novamente."}),["address_state","address_city","address_district","address_street"].map(function(r){try{e.candidate[r]="",document.querySelector("form[name=doarForm] *[name="+r+"]").disabled=!0}catch(a){}}),new Error("ERROR_GET_ZIPCODE")}),!1},e.candidate_projects=function(a){return r({method:"GET",url:"/api/candidate/"+a.id+"/projects"}).then(function(r){var a=r.data.projects;!function(){var e=0;a.map(function(r){e+=r.votes}),a=a.map(function(r){return r.total=e,r})}(),e.candidate.projects=a},function(e){throw d.shoot({route:document.location.href,error:JSON.stringify(e)}),new Error("Project list is invalid or cannot be found!")}),!1},e.doar_continue=function(r){if(!r||10>r)return n.swal("Preencha um valor superior a 10,00 reais."),!1;document.getElementById("amount-review").classList.remove("hide");var a=document.querySelectorAll(".valor-doa-container");for(var o in a)a[o]&&a[o].classList&&a[o].classList.add("hide");document.getElementById("doar-form").classList.remove("hide"),e.doar.amount=parseFloat(r),e.get_session()},e.doar_edit=function(){document.getElementById("amount-review").classList.add("hide");var e=document.querySelectorAll(".valor-doa-container");for(var r in e)e[r]&&e[r].classList&&e[r].classList.remove("hide");document.getElementById("doar-form").classList.add("hide")},e.get_session=function(){var a=e.candidate.id||0;return r({url:"/api/candidate/"+a+"/donate/session"}).then(function(r){e.payment.session=r.data.id,console.log("SESSION: "+r.data.id),PagSeguroDirectPayment.setSessionId(r.data.id)},function(e){throw d.shoot({route:"/cadastro/boleto",error:JSON.stringify(e)}),new Error("ERROR_GET_SESSION")}),!1},e.send_donation=function(){var r=PagSeguroDirectPayment.getSenderHash();console.log("SENDER: "+r);var a=e.card_params();console.log(a),e.card_brand({bin:a.card_number.slice(0,6),success_cb:function(r){var o=r.brand?r.brand:void 0;o&&e.card_token({card_number:a.card_number,brand:o.name,cvv:a.card_cvv,month:a.card_month,year:a.card_year,success_cb:function(e){console.log(e)},error_cb:function(){throw n.swal("Cart\xe3o inv\xe1lido","N\xe3o foi poss\xedvel obter as informa\xe7\xf5es do cart\xe3o!"),new Error("CARDBRAND_GET_ERROR")}})},error_cb:function(){throw n.swal("Cart\xe3o inv\xe1lido","N\xe3o foi poss\xedvel obter as informa\xe7\xf5es do cart\xe3o!"),new Error("CARDBRAND_GET_ERROR")}})},e.payment_method=function(e){PagSeguroDirectPayment.getPaymentMethods({amount:parseFloat(e.amount),success:e.success_cb,error:e.error_cb,complete:e.complete_cb})},e.card_brand=function(e){PagSeguroDirectPayment.getBrand({cardBin:e.bin,success:e.success_cb||function(){},error:e.error_cb||function(){},complete:e.complete_cb||function(){}})},e.card_token=function(e){PagSeguroDirectPayment.createCardToken({cardNumber:e.card_number,brand:e.brand,cvv:e.cvv,expirationMonth:e.month,expirationYear:e.year,success:e.success_cb||function(){},error:e.error_cb||function(){},complete:e.complete_cb||function(){}})},e.donation_params=function(){return Params.require(e.doar).permit("")},e.card_params=function(){return Params.require(e.payment).permit("card_number","card_month","card_year","card_cvv")},e.candidate_by_name(e.name)}]);