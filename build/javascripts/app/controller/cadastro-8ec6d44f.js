document.location.href.indexOf("/cadastro-completo")>=0&&app.votolegal.config(["$routeProvider",function(e){e.when("/dados-pessoais",{templateUrl:"/javascripts/app/view/cadastro/dados-pessoais.tmpl",controller:"CadastroController",activetab:"pessoal"}).when("/dados-campanha",{templateUrl:"/javascripts/app/view/cadastro/dados-campanha.tmpl",controller:"CadastroController",activetab:"campanha"}).when("/projetos",{templateUrl:"/javascripts/app/view/cadastro/projetos.tmpl",controller:"CadastroController",activetab:"projetos"}).otherwise({redirectTo:"/dados-pessoais",activetab:"pessoal"})}]),app.votolegal.controller("CadastroController",["$scope","$http","$location","$route","$interval","auth_service","serialize","SweetAlert",function(e,t,r,a,i,n,o,s){e.activetab="pessoal",e.candidate={},e.issue_list=[],e.projects=[{id:0,title:"",scope:"",changed:!0}],e.submit_disabled=!1,e.progress=0,e.date_to_profile=function(){var e=0;return e=new Date("08/15/2016 00:00:00")-new Date,Math.round(e/864e5)+1}(),e.check_percent=function(){var t=0;if(e.candidate){var r=e.candidate;r.picture&&r.picture.length&&(t+=6),r.video_url&&r.video_url.length&&(t+=6),r.facebook_url&&r.facebook_url.length&&(t+=4),r.twitter_url&&r.twitter_url.length&&(t+=4),r.instagram_url&&r.instagram_url.length&&(t+=4),r.website_url&&r.website_url.length&&(t+=4),r.public_email&&r.public_email.length&&(t+=6),r.summary&&r.summary.length&&(t+=6),r.biography&&r.biography.length&&(t+=6),r.responsible_name&&r.responsible_name.length&&(t+=4),r.responsible_email&&r.responsible_email.length&&(t+=4),r.raising_goal&&r.raising_goal.length&&(t+=6),r.cielo_merchant_key&&r.cielo_merchant_key.length&&(t+=6),r.spending_spreadsheet&&r.spending_spreadsheet.length&&(t+=4)}if(e.issue_list){var a=e.issue_list;a&&a.length>0&&(t+=10)}e.projects&&e.projects&&e.projects.length>=4&&(t+=20),e.progress=t},e.changed_project=function(t){e.projects[t].changed=!0},e.save_candidate=function(){var r=e.candidate_params(),a=n.current_user();return r.api_key=a.api_key,t({method:"PUT",url:"//45.55.50.43/api/candidate/"+a.id,data:r,headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;for(var r in e)t.append(r,e[r]);var a=document.querySelector("input[name=picture]");if(a.files.length>0){var i=a.files[0];t.append("picture",i,i.name)}return t}}).then(function(){s.swal("Os dados da campanha foram salvos!")},function(){throw s.swal("Error","Os dados da campanha n\xe3o puderam ser salvos!"),new Error("ERROR_SAVING_CAMPAIGN")}),!1},e.save_campaign=function(){var r=e.campaign_params(),a=n.current_user();return r.api_key=a.api_key,t({method:"PUT",url:"//45.55.50.43/api/candidate/"+a.id,data:r,headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;for(var r in e)t.append(r,e[r]);var a=document.querySelector("input[name=spending_spreadsheet]");if(a.files.length>0){var i=a.files[0];t.append("spending_spreadsheet",i,i.name)}return t}}).then(function(){s.swal("Os dados da campanha foram salvos!")},function(e){var t=e.data;if(t.hasOwnProperty("form_error"))return t.form_error.hasOwnProperty("spending_spreadsheet")&&"invalid file"==t.form_error.spending_spreadsheet&&s.swal("Formato do arquivo de Planilha de Gastos inv\xe1lido!"),!1;throw s.swal("Error","Os dados da campanha n\xe3o puderam ser salvos!"),new Error("ERROR_SAVING_CAMPAIGN")}),!1},e.save_project=function(r){var a=e.projects[r];if(""==a.title||""==a.scope)return s.swal("Os campos de Titulo e Descri\xe7\xe3o s\xe3o obrigat\xf3rios"),!1;var i={title:a.title,scope:a.scope};a.hasOwnProperty("id")&&a.id>0&&(i.id=a.id);var c=n.current_user();return i.api_key=c.api_key,t({method:a.id&&a.id>0?"PUT":"POST",url:"//45.55.50.43/api/candidate/"+c.id+"/projects"+(a.id&&a.id>0?"/"+a.id:""),data:o.from_object(i),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){s.swal("O projeto foi salvo!")},function(){throw s.swal("Error","O projeto n\xe3o pode ser salvo!"),new Error("ERROR_SAVING_PROJECT")}),!1},e.new_project=function(){return e.projects.push({id:0,title:"",scope:"",changed:!0}),!1},e.remove_project=function(r){var a=e.projects[r];return s.swal({title:"Tem certeza?",text:"Voc\xea tem certeza que deseja remover este projeto?",showCancelButton:!0,confirmButtonText:"Sim",cancelButtonText:"N\xe3o",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i)if(a.hasOwnProperty("id")&&a.id>0){var o=n.current_user();t["delete"]("//45.55.50.43/api/candidate/"+o.id+"/projects/"+a.id+"?api_key="+o.api_key).then(function(){e.projects.splice(r,1),swal("O projeto foi removido com sucesso!")},function(){throw new Error("ERROR_DELETE_PROJECTS")})}else e.projects.splice(r,1)}),!1},e.count_checked=function(t){var r=e.issue_list.filter(function(e){return e.selected?!0:void 0});return r.length>4&&(t&&(t.i.selected=!1),swal("Selecione apenas 4 assuntos priorit\xe1rios.")),!1},e.candidate_params=function(){return Params.require(e.candidate).permit("picture","video_url","facebook_url","twitter_url","instagram_url","website_url","public_email","responsible_name","responsible_email")},e.campaign_params=function(){var t=e.issue_list.filter(function(e){return e.selected?!0:void 0}),r=[];for(var a in t)r.push(t[a].id);var i={raising_goal:e.candidate.raising_goal,issue_priorities:r.join(","),cielo_merchant_key:e.candidate.cielo_merchant_key};return Params.require(i).permit("raising_goal","issue_priorities","cielo_merchant_key")},e.projects_params=function(){for(var e=[],t=document.querySelectorAll(".project-item"),r=0;r<t.length;r++){var a=t[r],i=a.getAttribute("data-id").replace("item-",""),n=a.querySelector("input[name=project_title]").value,o=a.querySelector("textarea[name=project_content]").value;e.push({id:i,title:n,content:o})}return e},e.get_candidate=function(){var r={},a=n.current_user();return r.api_key=a.api_key,t.get("//45.55.50.43/api/candidate/"+a.id+"?api_key="+a.api_key).then(function(t){e.candidate=t.data.candidate,e.get_issues_priority()},function(){throw new Error("ERROR_GET_CANDIDATE")}),!1},e.get_projects=function(){var r=n.current_user();t.get("//45.55.50.43/api/candidate/"+r.id+"/projects",{api_key:r.api_key}).then(function(t){var r=t.data.projects.map(function(e){return e.changed=!1,e});r.length>0&&(e.projects=r),e.check_percent()},function(){throw new Error("ERROR_GET_PROJECTS")})},e.get_issues_priority=function(){t.get("//45.55.50.43/api/issue_priority").then(function(t){e.issue_list=t.data.issue_priority;for(var r in e.issue_list)e.candidate.hasOwnProperty("candidate_issue_priorities")&&e.candidate.candidate_issue_priorities.map(function(t){e.issue_list[r].id==t.id&&(e.issue_list[r].selected=!0)});e.check_percent()},function(){throw new Error("ERROR_GET_ISSUE_PRIORITY")})},e._get_tabname=function(){var e=r.path();return-1!=e.indexOf("/dados-pessoais")?"pessoal":-1!=e.indexOf("/dados-campanha")?"campanha":-1!=e.indexOf("/projetos")?"projetos":void 0},n.validate_user({role:"user"}),e.activetab=e._get_tabname(),console.log(e.activetab),e.get_candidate(),e.get_projects(),e.check_percent()}]);