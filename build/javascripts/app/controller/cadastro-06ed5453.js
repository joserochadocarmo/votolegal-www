document.location.href.indexOf("/cadastro-completo")>=0&&app.votolegal.config(["$routeProvider",function(e){e.when("/dados-pessoais",{templateUrl:"/javascripts/app/view/cadastro/dados-pessoais.tmpl",controller:"CadastroController"}).when("/dados-campanha",{templateUrl:"/javascripts/app/view/cadastro/dados-campanha.tmpl",controller:"CadastroController"}).when("/projetos",{templateUrl:"/javascripts/app/view/cadastro/projetos.tmpl",controller:"CadastroController"}).otherwise({redirectTo:"/dados-pessoais"})}]),app.votolegal.controller("CadastroController",["$scope","$http","$location","auth_service","serialize","SweetAlert",function(e,t,r,a,n,i){e.issues={},e.candidate={},e.projects=[{id:0,title:"",scope:"",changed:!0}],e.tabname="pessoal",e.submit_disabled=!1,e.progress={percent:0},e.issue_list=[],e.$watch("progress",function(){e.progress.percent=e.progress.percent}),e.check_percent=function(){var t=0;e.projects.length>=4&&(t+=30),e.progress.percent=t},e.changed_project=function(t){e.projects[t].changed=!0},e.save_candidate=function(){var r=e.candidate_params(),n=a.current_user();return r.api_key=n.api_key,t({method:"PUT",url:"/api/candidate/"+n.id,data:r,headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;for(var r in e)t.append(r,e[r]);var a=document.querySelector("input[name=picture]");if(a.files.length>0){var n=a.files[0];t.append("picture",n,n.name)}return t}}).then(function(){i.swal("Os dados da campanha foram salvos!")},function(){throw i.swal("Error","Os dados da campanha n\xe3o puderam ser salvos!"),new Error("ERROR_SAVING_CAMPAIGN")}),!1},e.save_campaign=function(){var r=e.campaign_params(),n=a.current_user();return r.api_key=n.api_key,t({method:"PUT",url:"/api/candidate/"+n.id,data:r,headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;for(var r in e)t.append(r,e[r]);var a=document.querySelector("input[name=spending_spreadsheet]");if(a.files.length>0){var n=a.files[0];t.append("spending_spreadsheet",n,n.name)}return t}}).then(function(){i.swal("Os dados da campanha foram salvos!")},function(){throw i.swal("Error","Os dados da campanha n\xe3o puderam ser salvos!"),new Error("ERROR_SAVING_CAMPAIGN")}),!1},e.save_project=function(r){var o=e.projects[r];if(""==o.title||""==o.scope)return i.swal("Os campos de Titulo e Descri\xe7\xe3o s\xe3o obrigat\xf3rios"),!1;var s={title:o.title,scope:o.scope};o.hasOwnProperty("id")&&o.id>0&&(s.id=o.id);var c=a.current_user();return s.api_key=c.api_key,t({method:o.id&&o.id>0?"PUT":"POST",url:"/api/candidate/"+c.id+"/projects"+(o.id&&o.id>0?"/"+o.id:""),data:n.from_object(s),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){e.projects[r].changed=!1,i.swal("O projeto foi salvo!")},function(){throw i.swal("Error","O projeto n\xe3o pode ser salvo!"),new Error("ERROR_SAVING_PROJECT")}),!1},e.create_issue=function(){var t=e.issue_name;$("#new-issue-priority").modal("hide");if(t){var r=e.issue_list.filter(function(e){return e.selected?!0:void 0});r.length>=4?i.swal("Selecione apena 4 assuntos"):e.issue_list.push({selected:!0,id:11,name:t})}return e.issue_name="",!1},e.update=function(){var r=e.candidate_params();e.error_list=[];var i=a.current_user();return r.api_key=i.api_key,e.submit_disabled=!0,t.put("/api/candidate/"+i.id,n.from_object(r),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),!1},e.new_project=function(){return e.projects.push({id:0,title:"",scope:"",changed:!0}),!1},e.remove_project=function(r){var n=e.projects[r];return i.swal({title:"Tem certeza?",text:"Voc\xea tem certeza que deseja remover este projeto?",showCancelButton:!0,confirmButtonText:"Sim",cancelButtonText:"N\xe3o",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i)if(n.hasOwnProperty("id")&&n.id>0){var o=a.current_user();t["delete"]("/api/candidate/"+o.id+"/projects/"+n.id+"?api_key="+o.api_key).then(function(){e.projects.splice(r,1),swal("O projeto foi removido com sucesso!"),e.check_percent()},function(){throw new Error("ERROR_DELETE_PROJECTS")})}else e.projects.splice(r,1)}),!1},e.count_checked=function(t){var r=e.issue_list.filter(function(e){return e.selected?!0:void 0});return r.length>4&&(t&&(t.i.selected=!1),swal("Selecione apena 4 assuntos")),!1},e.candidate_params=function(){return Params.require(e.candidate).permit("picture","video_url","facebook_url","twitter_url","instagram_url","website_url","public_email","responsible_name","responsible_email")},e.campaign_params=function(){var t=e.issue_list.filter(function(e){return e.selected?!0:void 0}),r=[];for(var a in t)r.push(t[a].id);var n={raising_goal:e.candidate.raising_goal,issue_priorities:r.join(","),cielo_merchant_key:e.candidate.cielo_merchant_key};return Params.require(n).permit("raising_goal","issue_priorities","cielo_merchant_key")},e.projects_params=function(){for(var e=[],t=document.querySelectorAll(".project-item"),r=0;r<t.length;r++){var a=t[r],n=a.getAttribute("data-id").replace("item-",""),i=a.querySelector("input[name=project_title]").value,o=a.querySelector("textarea[name=project_content]").value;e.push({id:n,title:i,content:o})}return e},e.get_candidate=function(){var r={},i=a.current_user();return r.api_key=i.api_key,t.get("/api/candidate/"+i.id,n.from_object(r)).then(function(t){e.candidate=t.data.candidate},function(){throw new Error("ERROR_GET_CANDIDATE")}),!1},e.get_projects=function(){var r=a.current_user();t.get("/api/candidate/"+r.id+"/projects",{api_key:r.api_key}).then(function(t){var r=t.data.projects.map(function(e){return e.changed=!1,e});e.projects=r,e.check_percent()},function(){throw new Error("ERROR_GET_PROJECTS")})},e.get_issues_priority=function(){t.get("/api/issue_priority").then(function(t){e.issue_list=t.data.issue_priority;for(var r in e.issue_list)e.candidate.hasOwnProperty("candidate_issue_priorities")&&e.candidate.candidate_issue_priorities.map(function(t){e.issue_list[r].id==t.id&&(e.issue_list[r].selected=!0)});e.check_percent()},function(){throw new Error("ERROR_GET_ISSUE_PRIORITY")})},e._get_tabname=function(){var e=r.path();return"/dados-pessoais"==e?"pessoal":"/dados-campanha"==e?"campanha":"/projetos"==e?"projetos":void 0},a.validate_user({role:"user"}),e.tabname=e._get_tabname(),e.get_candidate(),e.get_issues_priority(),e.get_projects(),e.check_percent()}]);