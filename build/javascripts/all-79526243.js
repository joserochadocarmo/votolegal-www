!function(r){Array.prototype.map||(Array.prototype.map=function(r,e){var t,o,a;if(null==this)throw new TypeError(" this is null or not defined");var n=Object(this),i=n.length>>>0;if("function"!=typeof r)throw new TypeError(r+" is not a function");for(arguments.length>1&&(t=e),o=new Array(i),a=0;i>a;){var s,c;a in n&&(s=n[a],c=r.call(t,s,a,n),o[a]=c),a++}return o});var e={absolute:function(){return document.location.href},query:function(r){var e=this.absolute();r=r.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+r+"(=([^&#]*)|&|#|$)"),o=t.exec(e);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}},t=function(){this.from_object=function(r){var e=[];if("object"!=typeof r)throw new Error("Param to be serializer isnt a object");for(var t in r)if(r.hasOwnProperty(t)){var o=r[t];e.push(encodeURIComponent(t)+"="+encodeURIComponent(null==o?"":o))}return e.join("&").replace(/%20/g,"+")},this.from_form=function(r){var e=document.forms[r],t={};for(var o in e.elements)void 0!==e.elements[o].type&&(t[e.elements[o].name]=e.elements[o].value);return this.from_object(t)},this.to_json=function(r){return JSON.stringify(r)}},o=function(r){var e={missing:" n\xe3o foi preenchido.",invalid:" est\xe1 inv\xe1lido.","already exists":" j\xe1 foi cadastrado.","access denied":"Acesso negado!","Bad email or password.":"E-mail ou senha inv\xe1lidos.","invalid token":" \xe9 invalido ou esta expirado."};return e[r]};r.votolegal=angular.module("votolegal",["ngMask","ngSanitize","angular-storage","idf.br-filters"]),r.votolegal.config(["$httpProvider","$locationProvider",function(r,e){delete r.defaults.headers.common["X-Requested-With"],r.defaults.headers.common["Content-Type"]="application/x-www-form-urlencoded",e.html5Mode(!1)}]),r.votolegal.filter("unsafe",["$sce",function(r){return function(e){return r.trustAsHtml(e)}}]),r.votolegal.factory("postmon",["$http",function(r){return function(e){return r.get("//api.postmon.com.br/v1/cep/"+e,{cache:!1})}}]),r.votolegal.factory("serialize",function(){return new t}),r.votolegal.factory("auth_service",["$http","serialize","store",function(r,e,t){return{session_key:"user",sign_page:"/admin/signin",admin_page:"/admin",role_list:{admin:"/admin",user:"/pre-cadastro/aprovado"},authenticate:function(t,o){return r({method:"POST",url:"/api/login",data:e.from_object({email:t,password:o}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},forgot_password:function(t){return r({method:"POST",url:"/api/login/forgot_password",data:e.from_object({email:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},change_password:function(t,o){return r({method:"POST",url:"/api/login/forgot_password/reset/"+o,data:e.from_object({new_password:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},session:function(){return t},current_user:function(){return this.session().get(this.session_key)},validate_user:function(){var r=arguments[0]||{},e=this.current_user();return-1==document.location.href.indexOf(this.sign_page)&&(void 0==e&&(document.location=this.sign_page),e.role!=r.role&&(document.location="/error/permissao-negada")),!1},logout:function(){return this.session().remove(this.session_key),arguments[0]&&(document.location=arguments[0]),!1}}}]),r.votolegal.controller("PreCadastroController",["$scope","$http","postmon","serialize",function(r,e,t,a){r.candidate={},r.submit_disabled=!1,r.register_params=function(){return r.candidate},r.create=function(){var t=r.register_params();return r.error_list=[],r.candidate.password&&r.candidate.password==r.candidate.confirm_password?r.accept_terms||r.transparent_campaign?(r.submit_disabled=!0,e({method:"POST",url:"/api/register",data:a.from_object(t),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){return 0==r.error_list.length&&(document.location="/pre-cadastro/success"),!1},function(e){var t=e.data.form_error,a=function(r){return document.querySelector("form[name=candidateForm] *[name="+r+"]")};for(var n in t){var i=a(n).attributes.placeholder.value;r.error_list.push(i+o(t[n]))}throw r.candidate.password&&r.candidate.password!=r.candidate.confirm_password&&r.error_list.push("Os campos de senha devem ser iguais."),r.accept_terms||r.transparent_campaign||(r.accept_terms||r.error_list.push("Voc\xea deve aceitar os termos de uso."),r.transparent_campaign||r.error_list.push("Voc\xea deve aceitar fazer uma campanha transparente.")),r.submit_disabled=!1,new Error("ERROR_POST_NEW_CADIDATE")}),!1):(r.accept_terms||r.error_list.push("Voc\xea deve aceitar os termos de uso."),r.transparent_campaign||r.error_list.push("Voc\xea deve aceitar fazer uma campanha transparente."),!1):(r.error_list.push("Os campos de senha devem ser iguais."),!1)},r.address_by_zipcode=function(){var e=r.candidate.address_zipcode;return 9==e.length&&t(e).then(function(e){var t=e.data,o=r.candidate;o.address_city=t.cidade,o.address_state=t.estado_info.nome;var a=document.querySelector("form[name=candidateForm] *[name=address_street]");t.bairro&&t.logradouro?(o.address_street=t.logradouro+" - "+t.bairro,a.disabled=!0):(o.address_street="",a.disabled=!1)},function(){throw swal({title:"Problemas ao carregar os dados do CEP!",text:"Ocorreu um erro ao tentar carregar os dados de sua localidade. Verifique o CEP e tente novamente."}),new Error("ERROR_GET_ZIPCODE")}),!1},r.load_parties=function(){e.get("/api/party").then(function(e){r.party_list=e.data.party},function(){throw r.party_list=[],new Error("ERROR_GET_PARTY_LIST")})},r.load_offices=function(){e.get("/api/office").then(function(e){r.office_list=e.data.office},function(){throw r.office_list=[],new Error("ERROR_GET_OFFICE_LIST")})},r.reset=function(){r.candidate={}},r.load_offices(),r.load_parties()}]),r.votolegal.controller("ContatoController",["$scope","$http","serialize",function(r,e,t){r.message={},r.message_params=function(){return r.message},r.create=function(){var a=r.message_params();return e({method:"POST",url:"/api/contact",data:t.from_object(a),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(r){r.data;return document.location="/contato/success",!1},function(e){var t=e.data.form_error,a=function(r){return document.querySelector("form[name=contactForm] *[name="+r+"]")};r.error_list=[];for(var n in t){var i=a(n).attributes.placeholder.value;r.error_list.push(i+o(t[n]))}throw new Error("ERROR_POST_NEW_CONTACT")}),!1}}]),r.votolegal.controller("FaqController",["$scope","$sce",function(r){r.highlight=!0,r.faq_list=faq_list,r.search_answer=function(e){var t=faq_list.map(function(r){return r.title.match(new RegExp(e,"ig"))||r.content.match(new RegExp(e,"gi"))?r:void 0}),o=function(r){var e=[];for(var t in r)void 0!==r[t]&&e.push(r[t]);return e};return r.faq_list=o(t),!1}}]),r.votolegal.controller("AuthController",["$scope","$http","auth_service",function(r,t,a){r.signin={},r.error_list=[],r.signin.token=e.query("token"),r.signin_params=function(){return r.signin},r.forgot_password=function(){r.error_list=[];var e=r.signin_params();return a.forgot_password(e.email).then(function(r){r.data;document.location="/conta/recuperar-senha/success"},function(e){var t=e.data;if(t.hasOwnProperty("form_error")){var t=t.form_error,a=function(r){return document.querySelector("form[name=forgotForm] *[name="+r+"]")};for(var n in t){var i=a(n).attributes.placeholder.value;r.error_list.push(i+o(t[n]))}}else r.error_list.push(o(t.error));throw new Error("ERROR_FORGOT_PASSWORD")}),!1},r.change_password=function(){r.error_list=[];var e=r.signin_params();return null==e.password&&r.error_list.push("Nova Senha \xe9 um campo obrigat\xf3rio."),e.password!==e.confirm_password&&r.error_list.push("Os campos de senha devem ser iguais."),r.error_list.length>0?!1:(a.change_password(e.password,e.token).then(function(r){r.data;document.location="/conta/trocar-senha/success"},function(e){var t=e.data;if(t.hasOwnProperty("form_error")){var t=t.form_error,a=function(r){return document.querySelector("form[name=changePasswordForm] *[name="+r+"]")};for(var n in t){var i=a(n).attributes.placeholder.value;r.error_list.push(i+o(t[n]))}}else r.error_list.push(o(t.error));throw new Error("ERROR_CHANGE_PASSWORD")}),!1)},r.authenticate=function(){var e=r.signin_params();return a.authenticate(e.email,e.password).then(function(r){var e=r.data,t=e.roles||[],o=a.session();if(o.set(a.session_key,{id:e.user_id,api_key:e.api_key,role:t[0]||null}),0==t.length)return document.location="/admin/signin",!1;for(var n in t)"admin"===t[n]&&(document.location="/admin"),"user"===t[n]&&(document.location="/pre-cadastro/aprovado")},function(e){r.error_list=[];var t=e.data;if(t.form_error){var t=t.form_error,a=function(r){return document.querySelector("form[name=signinForm] *[name="+r+"]")};for(var n in t){var i=a(n).attributes.placeholder.value;r.error_list.push(i+o(t[n]))}}else r.error_list.push(o(t.error));throw new Error("ERROR_AUTH_USER")}),!1}}]),r.votolegal.controller("DashboardController",["$scope","$http","auth_service","serialize",function(r,e,t){r.list=[],r.approval_list=function(){var o=t.current_user();e({method:"GET",url:"/api/admin/candidate/list?api_key="+o.api_key}).then(function(e){var t=e.data;return r.list=t,!1},function(r){var e=r.data;return"access denied"===e.error&&(document.location=t.sign_page),!1})},r.allow=function(a){var n=t.current_user();return e({method:"PUT",url:"/api/admin/candidate/"+a.id+"/activate?api_key="+n.api_key}).then(function(){swal("Pr\xe9-candidato aprovado com sucesso"),r.approval_list()},function(r){var e=r.data;swal(o(e.error))}),!1},r.deny=function(a){var n=t.current_user();return e({method:"PUT",url:"/api/admin/candidate/"+a.id+"/deactivate?api_key="+n.api_key}).then(function(){return swal("Pr\xe9-candidato rejeitado com sucesso"),r.approval_list(),!1},function(r){var e=r.data;return swal(o(e.error)),!1}),!1},r.approval_list(),t.validate_user({role:"admin"})}]),r.votolegal.controller("PreCandidateController",["$scope","$http","$location","serialize","auth_service",function(r,e,t,o,a){var n=a.current_user();r.model={},r.params=t.search(),r.load=function(t){try{t=parseInt(t)}catch(o){throw new Error("Parametro id \xe9 inv\xe1lido")}return e({method:"GET",url:"/api/candidate/"+t+"?api_key="+n.api_key}).then(function(e){var t=e.data.candidate;r.model=t},function(){throw new Error("Model is invalid or cannot be found!")}),!1},r.load(r.params.id),a.validate_user({role:"admin"})}]),r.votolegal.controller("DefaultController",["$scope","$http","auth_service","serialize",function(r,e,t){t.validate_user({role:"user"})}]),r.votolegal.controller("CadastroController",["$scope","$http","auth_service","serialize",function(r,e,t,o){r.candidate={},r.form_tab="personal",r.submit_disabled=!1,r.progress={percent:0},r.register_params=function(){return r.candidate},r.update=function(){var a=r.register_params();r.error_list=[],console.log(angular.toJson(a));var n=t.current_user();return a.api_key=n.api_key,console.log(a),r.submit_disabled=!0,e.put("/api/candidate/"+n.id+"?api_key="+a.api_key,o.from_object(a),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),!1},r.reset=function(){r.candidate={}},t.validate_user({role:"user"})}])}(window.app=window.app||{});